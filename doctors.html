<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find a Doctor</title>
</head>
<body style="font-family: Arial, sans-serif; background-color: #f8f9fa; padding: 20px;">

<div style="max-width: 1000px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
    <h2 style="text-align: center;">Find a Doctor</h2>

    <!-- Filters -->
    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
        <input type="text" id="searchName" placeholder="Search by name..." onkeyup="filterDoctors()" 
               style="padding: 10px; width: 200px; border: 1px solid #ddd; border-radius: 5px;">
        <select id="specialistFilter" onchange="filterDoctors()" 
                style="padding: 10px; width: 200px; border: 1px solid #ddd; border-radius: 5px;">
            <option value="">Select Specialization</option>
        </select>
        <select id="locationFilter" onchange="filterDoctors()" 
                style="padding: 10px; width: 200px; border: 1px solid #ddd; border-radius: 5px;">
            <option value="">Select Location</option>
        </select>
    </div>

    <!-- Doctor List -->
    <div id="doctorList" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
        <!-- Doctors will be added dynamically -->
    </div>
</div>

<script>
    let doctors = []; // Store fetched doctor data

    // Fetch all doctors from backend API
    async function fetchDoctors() {
        try {
            const response = await fetch("http://localhost:8000/api/doctors");  // Update with your backend URL
            doctors = await response.json();  
            populateFilters(doctors);  // Populate dropdown filters dynamically
            displayDoctors(doctors);  // Show all doctors initially
        } catch (error) {
            console.error("Error fetching doctors:", error);
        }
    }

    // Populate dropdowns with unique locations & specializations
    function populateFilters(doctors) {
        const specialistSet = new Set();
        const locationSet = new Set();

        doctors.forEach(doc => {
            specialistSet.add(doc.specialization);
            locationSet.add(doc.location);
        });

        populateDropdown("specialistFilter", specialistSet);
        populateDropdown("locationFilter", locationSet);
    }

    // Helper function to populate dropdown options
    function populateDropdown(id, values) {
        const dropdown = document.getElementById(id);
        dropdown.innerHTML = `<option value="">Select ${id.replace("Filter", "")}</option>`; // Default option
        values.forEach(value => {
            dropdown.innerHTML += `<option value="${value}">${value}</option>`;
        });
    }

    // Display doctors dynamically
    function displayDoctors(filteredDoctors) {
        const doctorList = document.getElementById("doctorList");
        doctorList.innerHTML = "";

        filteredDoctors.forEach(doctor => {
            const doctorCard = `
                <div style="background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 0 5px rgba(0, 0, 0, 0.1); text-align: center;">
                    <img src="${doctor.image || 'https://via.placeholder.com/80'}" alt="Doctor" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 10px;">
                    <h4 style="margin: 5px 0;">${doctor.name}</h4>
                    <p style="color: gray; font-size: 14px; margin: 2px 0;"><strong>${doctor.specialization}</strong></p>
                    <p style="color: gray; font-size: 14px; margin: 2px 0;">Location: ${doctor.location}</p>
                    <p style="color: gray; font-size: 14px; margin: 2px 0;">Experience: ${doctor.experience} years</p>
                    <p style="color: gray; font-size: 14px; margin: 2px 0;">Fees: $${doctor.fees}</p>
                </div>
            `;
            doctorList.innerHTML += doctorCard;
        });
    }

    // Filter doctors based on selected criteria
    function filterDoctors() {
        const nameSearch = document.getElementById("searchName").value.toLowerCase();
        const specialistFilter = document.getElementById("specialistFilter").value;
        const locationFilter = document.getElementById("locationFilter").value;

        const filteredDoctors = doctors.filter(doctor => {
            return (
                (doctor.name.toLowerCase().includes(nameSearch)) &&
                (specialistFilter === "" || doctor.specialization === specialistFilter) &&
                (locationFilter === "" || doctor.location === locationFilter)
            );
        });

        displayDoctors(filteredDoctors);
    }

    // Fetch doctors when page loads
    fetchDoctors();
</script>

</body>
</html>
